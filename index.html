<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=800" />
  <title>FPS Perception Test</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="main">
    <div class="info">
      <h2>Framerate Perception Test</h2>
      <p>Detected monitor rate: <span id="refreshRate">detecting...</span> Hz</p>
    </div>

    <div class="settings panel" id="settings">
      <div class="settings-header" id="settingsToggle">
        <h3 style="margin:0;">Test Settings</h3>
        <span class="settings-arrow">▼</span>
      </div>
      <div class="settings-content-wrapper">
        <div class="settings-content">
          <div class="setting-group">
            <label for="circleSpeed">Circle speed:</label>
            <input type="number" id="circleSpeed" value="8" min="1" max="20" step="0.5" />
          </div>
          <div class="setting-group">
            <label for="startBase">Start FPS:</label>
            <input type="number" id="startBase" value="15" min="1" max="240" />
          </div>
          <div class="setting-group">
            <label for="minBase">Minimum FPS:</label>
            <input type="number" id="minBase" value="10" min="1" max="240" />
          </div>
          <div class="setting-group">
            <label for="diffPct">% Difference:</label>
            <input type="number" id="diffPct" value="50" min="1" max="100" />
          </div>
          <div class="setting-group">
            <label for="initialStep">Initial step size (fps):</label>
            <input type="number" id="initialStep" value="15" min="1" max="60" />
          </div>
          <div class="setting-group">
            <label for="minStep">Minimum step (fps):</label>
            <input type="number" id="minStep" value="5" min="1" max="20" />
          </div>
          <div class="setting-group">
            <label for="targetReversals">Target reversals:</label>
            <input type="number" id="targetReversals" value="6" min="4" max="20" />
          </div>
          <div class="setting-group">
            <label for="maxTrials">Max trials:</label>
            <input type="number" id="maxTrials" value="60" min="10" max="200" />
          </div>
          <div class="setting-group">
            <label for="showFps">Show FPS values pre-choice:</label>
            <input type="checkbox" id="showFps" checked />
          </div>
          <div class="setting-group" style="justify-content:flex-end; margin-top:16px;">
            <button id="resetBtn" style="min-width:160px;">Reset / Apply Settings</button>
          </div>
        </div>
      </div>
    </div>
    <div class="canvas-row">
      <canvas id="canvasLeft" width="380" height="400"></canvas>
      <canvas id="canvasRight" width="380" height="400"></canvas>
    </div>
    <div id="fpsDisplay"></div>
    <div id="diffWarning" class="diff-warning"></div>

    <div class="controls">
      <button id="leftBtn">Left is Smoother</button>
      <button id="rightBtn">Right is Smoother</button>
      <button id="restartBtn">Restart Test</button>
    </div>

    <div class="score">
      Trial: <span id="trialNum">0</span> | Correct: <span id="correct">0</span> / <span id="total">0</span>
      (<span id="percentage">0</span>%)
      <div id="progressBar"><div id="progressFill"></div></div>
    </div>

    <div class="bottom">
      <div class="threshold-box panel">
        <h3>Estimated Perception Threshold</h3>
        <div id="thresholdDisplay" style="font-size:22px; margin-top:4px;">—</div>
        <div class="muted" id="thresholdCI"></div>
        <canvas id="chart"></canvas>
      </div>
      <div class="history-container panel">
        <h3 class="history-header">History</h3>
        <div id="history"></div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
